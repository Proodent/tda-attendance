<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendance Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #ffffff;
      color: #222;
      margin: 0;
      padding: 0;
    }

    header {
      background: #009245;
      color: #fff;
      padding: 1rem;
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
    }

    /* Dashboard layout */
    .dashboard {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }

    /* Row for main summary tiles */
    .summary-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 1rem;
    }

    .summary-tile {
      flex: 1 1 calc(30% - 1rem);
      min-width: 240px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      text-align: center;
      padding: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .summary-tile:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .summary-tile h3 {
      margin: 0;
      font-size: 1.1rem;
      color: #006837;
    }

    .summary-tile p {
      font-size: 1.8rem;
      font-weight: bold;
      color: #009245;
      margin: 0.4rem 0 0 0;
    }

    /* Charts section */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
    }

    .chart-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 1rem;
    }

    .chart-card h3 {
      text-align: center;
      color: #006837;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    canvas {
      width: 100% !important;
      height: 260px !important;
    }

    /* Log console */
    #log {
      background: #000;
      color: #0f0;
      font-family: monospace;
      padding: 1rem;
      height: 150px;
      overflow-y: auto;
      font-size: 0.85rem;
      border-radius: 8px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .summary-tile {
        flex: 1 1 100%;
      }
    }
  </style>
</head>

<body>
  <header>Attendance Dashboard</header>

  <section class="dashboard">
    <!-- Summary tiles -->
    <div class="summary-row">
      <div class="summary-tile">
        <h3>General Attendance</h3>
        <p id="generalAttendance">--</p>
      </div>
      <div class="summary-tile">
        <h3>Clock-In Report</h3>
        <p id="clockInReport">--</p>
      </div>
      <div class="summary-tile">
        <h3>Clock-Out Report</h3>
        <p id="clockOutReport">--</p>
      </div>
    </div>

    <!-- Charts section -->
    <div class="charts-grid">
      <div class="chart-card">
        <h3>Attendance Summary</h3>
        <canvas id="summaryChart"></canvas>
      </div>
      <div class="chart-card">
        <h3>Attendance Trend</h3>
        <canvas id="trendChart"></canvas>
      </div>
      <div class="chart-card" style="grid-column: span 2;">
        <h3>Location Attendance</h3>
        <canvas id="locationChart"></canvas>
      </div>
    </div>

    <div id="log"></div>
  </section>

  <script>
    const backendURL = "https://your-backend-url/api"; // replace with your backend endpoint

    const log = (msg) => {
      const logBox = document.getElementById("log");
      const time = new Date().toLocaleTimeString();
      logBox.innerHTML += `[${time}] ${msg}<br>`;
      logBox.scrollTop = logBox.scrollHeight;
    };

    let summaryChart, trendChart, locationChart;

    async function fetchJSON(url) {
      const res = await fetch(url);
      const text = await res.text();
      try {
        return JSON.parse(text);
      } catch {
        throw new Error("Response not JSON: " + text.slice(0, 60));
      }
    }

    async function loadDashboardData() {
      try {
        log("⏳ Fetching data...");
        // mock data for demo
        const generalAttendance = 78; // percent
        const clockIns = 42;
        const clockOuts = 31;
        const trend = [
          { date: "Mon", clockIns: 38 },
          { date: "Tue", clockIns: 40 },
          { date: "Wed", clockIns: 42 },
          { date: "Thu", clockIns: 45 },
          { date: "Fri", clockIns: 50 }
        ];
        const locations = [
          { name: "Accra", in: 20, out: 15 },
          { name: "Tema", in: 15, out: 10 },
          { name: "Kumasi", in: 12, out: 9 }
        ];

        // update tiles
        document.getElementById("generalAttendance").innerText = generalAttendance + "%";
        document.getElementById("clockInReport").innerText = clockIns;
        document.getElementById("clockOutReport").innerText = clockOuts;

        updateSummaryChart(generalAttendance, 100 - generalAttendance);
        updateTrendChart(trend);
        updateLocationChart(locations);

        log("✅ Dashboard updated");
      } catch (err) {
        log("❌ " + err.message);
      }
    }

    function updateSummaryChart(present, absent) {
      const ctx = document.getElementById("summaryChart");
      if (summaryChart) summaryChart.destroy();
      summaryChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["Present", "Absent"],
          datasets: [{
            data: [present, absent],
            backgroundColor: ["#009245", "#ccc"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "bottom" }
          }
        }
      });
    }

    function updateTrendChart(trendData = []) {
      const ctx = document.getElementById("trendChart");
      if (trendChart) trendChart.destroy();
      trendChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: trendData.map(t => t.date),
          datasets: [{
            label: "Clock-Ins",
            data: trendData.map(t => t.clockIns),
            borderColor: "#009245",
            backgroundColor: "rgba(0,146,69,0.1)",
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function updateLocationChart(locations) {
      const ctx = document.getElementById("locationChart");
      if (locationChart) locationChart.destroy();
      locationChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: locations.map(l => l.name),
          datasets: [
            {
              label: "Clock-Ins",
              data: locations.map(l => l.in),
              backgroundColor: "#009245"
            },
            {
              label: "Clock-Outs",
              data: locations.map(l => l.out),
              backgroundColor: "#ff4d4d"
            }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    loadDashboardData();
    setInterval(loadDashboardData, 10000);
  </script>
</body>
</html>
